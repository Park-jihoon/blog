<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Jihoon&#39;s IT Development | Web Developer&#39;s Hobby Development Notes</title>

  
  <meta name="author" content="Park-JiHoon">
  

  
  <meta name="description" content="평소 개발이 취미인 개발자의 마구잡이 정리노트">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="Jihoon&#39;s IT Development"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jihoon&#39;s IT Development" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Jihoon&#39;s IT Development</a>
    </h1>
    <p class="site-description">Web Developer&#39;s Hobby Development Notes</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/categories">Categories</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2020/01/03/Spring-boot의-ComponentScan-과-application-yml/"><span>Spring boot의 ComponentScan 과 application.yml</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/01/03/Spring-boot의-ComponentScan-과-application-yml/" rel="bookmark">
        <time class="entry-date published" datetime="2020-01-03T14:21:14.000Z">
          2020-01-03
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="Spring-Boot로-제작한-Application을-다른-Application에서-가져다-사용해보자"><a href="#Spring-Boot로-제작한-Application을-다른-Application에서-가져다-사용해보자" class="headerlink" title="Spring Boot로 제작한 Application을 다른 Application에서 가져다 사용해보자."></a>Spring Boot로 제작한 Application을 다른 Application에서 가져다 사용해보자.</h2><p>Spring Boot를 기반으로 제작한 Application을 다른 Application에서 가져다 사용하는 방법에 대해 알아보고, 문제가 될 수 있는 부분을 찾아본다.</p>
<h2 id="1-개요"><a href="#1-개요" class="headerlink" title="1. 개요"></a>1. 개요</h2><ul>
<li>Spring boot 를 기반으로 한 Demo1 제작</li>
<li>Demo1에서 application.yml에 값(value)을 입력</li>
<li>Demo1을 실행하여 application.yml의 값의 출력을 확인.</li>
<li>Demo1 packaging</li>
<li>Demo1의 jar 내부에 application.yml이 존재함을 확인.</li>
<li>Demo1에 대한 의존성을 가지고있는 Demo2를 작성</li>
<li>Demo2에서 Demo1의 application.yml 값을 가져와지는지 확인.</li>
</ul>
<h2 id="2-Demo1"><a href="#2-Demo1" class="headerlink" title="2. Demo1"></a>2. Demo1</h2><p>Spring Boot 를 기반으로 한 Demo1을 제작합니다.</p>
<h3 id="2-1-폴더구성"><a href="#2-1-폴더구성" class="headerlink" title="2.1. 폴더구성"></a>2.1. 폴더구성</h3><ul>
<li>실행을 위한 <code>Demo1Application.java</code>가 존재</li>
<li>application.yml의 값을 가져오기 위한 <code>Demo1Tester.java</code>가 위치</li>
</ul>
<img src="/2020/01/03/Spring-boot%EC%9D%98-ComponentScan-%EA%B3%BC-application-yml/directory.png" class="">


<h3 id="2-2-pom-xml"><a href="#2-2-pom-xml" class="headerlink" title="2.2. pom.xml"></a>2.2. pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>lombok 이외에는 특별한거 하나 없는 intellij 기본 생성 Spring Boot Application이다.</p>
</blockquote>
<h3 id="2-3-application-yml"><a href="#2-3-application-yml" class="headerlink" title="2.3. application.yml"></a>2.3. application.yml</h3><p><code>test.example.value</code> 의 값으로 <code>demo1</code>을 세팅한다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="attr">example:</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">demo1</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-Demo1Tester-java"><a href="#2-4-Demo1Tester-java" class="headerlink" title="2.4. Demo1Tester.java"></a>2.4. Demo1Tester.java</h3><blockquote>
<p>application.yml의 값을 가져오기 위한 Class<br>Autowired 테스트를 위해 <code>@Component</code>로 선언한다.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1Tester</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;test.example.value&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-Demo1Application-java"><a href="#2-5-Demo1Application-java" class="headerlink" title="2.5. Demo1Application.java"></a>2.5. Demo1Application.java</h3><blockquote>
<p><code>Demo1Tester</code>를 autowired 한 뒤 value 의 값을 가져와 log로 출력한다.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.example.demo1.logic.Demo1Tester;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1Application</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Demo1Tester tester;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Demo1Application</span><span class="params">(Demo1Tester tester)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tester = tester;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Demo1Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">"demo1 : tester.getValue() : &#123;&#125;"</span>, tester.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-Demo1-실행결과"><a href="#2-6-Demo1-실행결과" class="headerlink" title="2.6. Demo1 실행결과"></a>2.6. Demo1 실행결과</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___<span class="string">'_ __ _ _(_)_ __  __ _ \ \ \ \</span></span><br><span class="line"><span class="string">( ( )\___ | '</span>_ | <span class="string">'_| | '</span>_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  <span class="string">'  |____| .__|_| |_|_| |_\__, | / / / /</span></span><br><span class="line"><span class="string"> =========|_|==============|___/=/_/_/_/</span></span><br><span class="line"><span class="string"> :: Spring Boot ::        (v2.2.2.RELEASE)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2020-01-03 22:53:54.010  INFO 20040 --- [           main] com.example.demo1.Demo1Application       : Starting Demo1Application on park-PC with PID 20040 (started by park in D:\Dropbox\프리랜서\2020\demo1)</span></span><br><span class="line"><span class="string">2020-01-03 22:53:54.014  INFO 20040 --- [           main] com.example.demo1.Demo1Application       : No active profile set, falling back to default profiles: default</span></span><br><span class="line"><span class="string">2020-01-03 22:53:54.752  INFO 20040 --- [           main] com.example.demo1.Demo1Application       : Started Demo1Application in 1.351 seconds (JVM running for 5.656)</span></span><br><span class="line"><span class="string">2020-01-03 22:53:54.754  INFO 20040 --- [           main] com.example.demo1.Demo1Application       : tester.getValue() : demo1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>demo1</code>이 출력되는 것을 확인할 수 있다.</p>
</blockquote>
<h3 id="2-7-Demo1-packaging"><a href="#2-7-Demo1-packaging" class="headerlink" title="2.7. Demo1 packaging"></a>2.7. Demo1 packaging</h3><p>Spring Boot의 repackage를 스킵하도록 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&gt; mvn clean install -DskipTests -Dspring-boot.repackage.skip=<span class="literal">true</span></span><br><span class="line">[INFO] Scanning <span class="keyword">for</span> projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] -------------------------&lt; com.example:demo1 &gt;--------------------------</span><br><span class="line">[INFO] Building demo1 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-clean-plugin:3.1.0:clean (default-clean) @ demo1 ---</span><br><span class="line">[INFO] Deleting D:\Dropbox\프리랜서\2020\demo1\target</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:3.1.0:resources (default-resources) @ demo1 ---</span><br><span class="line">[INFO] Using <span class="string">'UTF-8'</span> encoding to copy filtered resources.</span><br><span class="line">[INFO] Copying 1 resource</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ demo1 ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[INFO] Compiling 2 <span class="built_in">source</span> files to D:\Dropbox\프리랜서\2020\demo1\target\classes</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:3.1.0:testResources (default-testResources) @ demo1 ---</span><br><span class="line">[INFO] Using <span class="string">'UTF-8'</span> encoding to copy filtered resources.</span><br><span class="line">[INFO] skip non existing resourceDirectory D:\Dropbox\프리랜서\2020\demo1\src\<span class="built_in">test</span>\resources</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ demo1 ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[INFO] Compiling 1 <span class="built_in">source</span> file to D:\Dropbox\프리랜서\2020\demo1\target\<span class="built_in">test</span>-classes</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-surefire-plugin:2.22.2:<span class="built_in">test</span> (default-test) @ demo1 ---</span><br><span class="line">[INFO] Tests are skipped.</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-jar-plugin:3.1.2:jar (default-jar) @ demo1 ---</span><br><span class="line">[INFO] Building jar: D:\Dropbox\프리랜서\2020\demo1\target\demo1-0.0.1-SNAPSHOT.jar</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- spring-boot-maven-plugin:2.2.2.RELEASE:repackage (repackage) @ demo1 ---</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-install-plugin:2.5.2:install (default-install) @ demo1 ---</span><br><span class="line">[INFO] Installing D:\Dropbox\프리랜서\2020\demo1\target\demo1-0.0.1-SNAPSHOT.jar to C:\Users\park\.m2\repository\com\example\demo1\0.0.1-SNAPSHOT\demo1-0.0.1-SNAPS</span><br><span class="line">HOT.jar</span><br><span class="line">[INFO] Installing D:\Dropbox\프리랜서\2020\demo1\pom.xml to C:\Users\park\.m2\repository\com\example\demo1\0.0.1-SNAPSHOT\demo1-0.0.1-SNAPSHOT.pom</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  24.001 s</span><br><span class="line">[INFO] Finished at: 2020-01-03T22:55:24+09:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h3 id="2-8-Demo1-jar"><a href="#2-8-Demo1-jar" class="headerlink" title="2.8. Demo1.jar"></a>2.8. Demo1.jar</h3><img src="/2020/01/03/Spring-boot%EC%9D%98-ComponentScan-%EA%B3%BC-application-yml/directory3.png" class="">


<blockquote>
<p>application.yml 이 포함되었음을 확인할 수 있다.</p>
</blockquote>
<h2 id="3-Demo2"><a href="#3-Demo2" class="headerlink" title="3. Demo2"></a>3. Demo2</h2><p>Demo1에 의존성을 가지고 있는 Demo2를 생성한다.</p>
<h3 id="3-1-폴더구성"><a href="#3-1-폴더구성" class="headerlink" title="3.1. 폴더구성"></a>3.1. 폴더구성</h3><ul>
<li>실행을 위한 <code>Demo2Application.java</code>가 존재</li>
<li>여러가지 케이스 테스트를 위한 application.yml 존재</li>
</ul>
<img src="/2020/01/03/Spring-boot%EC%9D%98-ComponentScan-%EA%B3%BC-application-yml/directory2.png" class="">


<h3 id="3-2-pom-xml"><a href="#3-2-pom-xml" class="headerlink" title="3.2. pom.xml"></a>3.2. pom.xml</h3><blockquote>
<p>demo1 의 라이브러리를 dependency에 추가한다.</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-Demo2Application-java"><a href="#3-3-Demo2Application-java" class="headerlink" title="3.3. Demo2Application.java"></a>3.3. Demo2Application.java</h3><blockquote>
<p><code>@ComponentScan</code> 으로 demo1의 @Component를 탐색한다.<br><code>Demo1Tester</code> Class를 Autowired 한다.<br>value 값을 출력한다.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.example.demo1.logic.Demo1Tester;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.example.demo1"</span>, <span class="string">"com.example.demo2"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2Application</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Demo1Tester tester;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Demo2Application</span><span class="params">(Demo1Tester tester)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tester = tester;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Demo2Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">"demo2 : tester.getValue() : &#123;&#125;"</span>, tester.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-결과"><a href="#4-결과" class="headerlink" title="4. 결과"></a>4. 결과</h2><h3 id="4-1-시나리오1"><a href="#4-1-시나리오1" class="headerlink" title="4.1. 시나리오1"></a>4.1. 시나리오1</h3><p>기본실행</p>
<ul>
<li>Demo2 application.yml 삭제 (null)</li>
<li>Demo2Application 실행</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-01-04 00:10:06.508  INFO 2968 --- [           main] com.example.demo2.Demo2Application       : Starting Demo2Application on park-PC with PID 2968 (started by park <span class="keyword">in</span> D:\Dropbox\프리랜서\2020\demo2)</span><br><span class="line">2020-01-04 00:10:06.514  INFO 2968 --- [           main] com.example.demo2.Demo2Application       : No active profile <span class="built_in">set</span>, falling back to default profiles: default</span><br><span class="line">2020-01-04 00:10:07.687  INFO 2968 --- [           main] com.example.demo2.Demo2Application       : Started Demo2Application <span class="keyword">in</span> 1.853 seconds (JVM running <span class="keyword">for</span> 3.188)</span><br><span class="line">2020-01-04 00:10:07.693  INFO 2968 --- [           main] com.example.demo2.Demo2Application       : demo2 : tester.getValue() : demo1</span><br><span class="line">2020-01-04 00:10:07.695  INFO 2968 --- [           main] com.example.demo1.Demo1Application       : demo1 : tester.getValue() : demo1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>demo1과 demo2의 값이 <strong>demo1</strong>로 출력되는 것을 확인.<br><code>demo1 : tester.getValue</code> 은 demo2에 포함되는 코드가 아님에도 출력됐음을 확인.</p>
</blockquote>
<h3 id="4-2-시나리오2"><a href="#4-2-시나리오2" class="headerlink" title="4.2. 시나리오2"></a>4.2. 시나리오2</h3><ul>
<li>Demo2에 application.yml 추가 (empty)</li>
<li>Demo2Application 실행</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2020-01-04 00:16:29.628  INFO 14512 --- [           main] com.example.demo2.Demo2Application       : Starting Demo2Application on park-PC with PID 14512 (started by park <span class="keyword">in</span> D:\Dropbox\프리랜서\2020\demo2)</span><br><span class="line">2020-01-04 00:16:29.636  INFO 14512 --- [           main] com.example.demo2.Demo2Application       : No active profile <span class="built_in">set</span>, falling back to default profiles: default</span><br><span class="line">2020-01-04 00:16:30.569  WARN 14512 --- [           main] s.c.a.AnnotationConfigApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name <span class="string">'demo2Application'</span>: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name <span class="string">'demo1Tester'</span>: Injection of autowired dependencies failed; nested exception is java.lang.IllegalArgumentException: Could not resolve placeholder <span class="string">'test.example.value'</span> <span class="keyword">in</span> value <span class="string">"<span class="variable">$&#123;test.example.value&#125;</span>"</span></span><br><span class="line">2020-01-04 00:16:30.583  INFO 14512 --- [           main] ConditionEvaluationReportLoggingListener : </span><br><span class="line"></span><br><span class="line">Error starting ApplicationContext. To display the conditions report re-run your application with <span class="string">'debug'</span> enabled.</span><br><span class="line">2020-01-04 00:16:30.623 ERROR 14512 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name <span class="string">'demo2Application'</span>: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name <span class="string">'demo1Tester'</span>: Injection of autowired dependencies failed; nested exception is java.lang.IllegalArgumentException: Could not resolve placeholder <span class="string">'test.example.value'</span> <span class="keyword">in</span> value <span class="string">"<span class="variable">$&#123;test.example.value&#125;</span>"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>test.example.value</code> 값이 존재하지 않아 Spring boot 실행 시 에러 발생</p>
</blockquote>
<h3 id="4-3-시나리오3"><a href="#4-3-시나리오3" class="headerlink" title="4.3. 시나리오3"></a>4.3. 시나리오3</h3><ul>
<li>Demo2에 application.yml에 값 추가</li>
<li>Demo2Application 실행</li>
</ul>
<p>demo2/application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="attr">example:</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">demo2</span></span><br></pre></td></tr></table></figure>

<p>결과</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-01-04 00:18:22.742  INFO 19544 --- [           main] com.example.demo2.Demo2Application       : Starting Demo2Application on park-PC with PID 19544 (started by park <span class="keyword">in</span> D:\Dropbox\프리랜서\2020\demo2)</span><br><span class="line">2020-01-04 00:18:22.750  INFO 19544 --- [           main] com.example.demo2.Demo2Application       : No active profile <span class="built_in">set</span>, falling back to default profiles: default</span><br><span class="line">2020-01-04 00:18:23.970  INFO 19544 --- [           main] com.example.demo2.Demo2Application       : Started Demo2Application <span class="keyword">in</span> 1.969 seconds (JVM running <span class="keyword">for</span> 3.285)</span><br><span class="line">2020-01-04 00:18:23.973  INFO 19544 --- [           main] com.example.demo2.Demo2Application       : demo2 : tester.getValue() : demo2</span><br><span class="line">2020-01-04 00:18:23.974  INFO 19544 --- [           main] com.example.demo1.Demo1Application       : demo1 : tester.getValue() : demo2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>demo1과 demo2의 값이 <strong>demo2</strong>로 출력되는 것을 확인.<br><code>demo1 : tester.getValue</code> 은 demo2에 포함되는 코드가 아님에도 출력됐음을 확인.</p>
</blockquote>
<h3 id="4-4-결론"><a href="#4-4-결론" class="headerlink" title="4.4. 결론"></a>4.4. 결론</h3><ul>
<li>jar 내부 <em>application.yml</em> 은 <code>@ComponentScan</code> 시 값이 읽힐 수 있다.<ul>
<li>다만 jar를 import 하는 application의 <em>application.yml</em>이 아예 <strong>존재하지 않아야 한다</strong>.</li>
</ul>
</li>
<li>실행되는 application에 <em>application.yml</em> 설정파일이 존재한다면 jar내부의 <em>application.yml</em>은 <strong>무시</strong>된다.<ul>
<li>실행되는 application의 <em>application.yml</em> 내부 값이 적용된다.</li>
</ul>
</li>
</ul>
<h2 id="5-추가"><a href="#5-추가" class="headerlink" title="5. 추가"></a>5. 추가</h2><ul>
<li>@ComponentScan 시 basePackages 설정에 대한 고민</li>
</ul>
<p>위의 테스트에서 자꾸 demo2에 포함되지 않는 demo1의 코드가 실행되는 것을 알 수 있다. 이는 @ComponentScan의 basePackages에 com.example.demo1 로 설정되어있기 때문이다. (원하지 않는 Demo1Application이 실행될 수 있다는 이야기다.)<br>따라서 다른 Application의 Component를 사용할 경우에는 최소한의 범위로 선언해서 사용할 수 있도록 해야한다.</p>
<p><code>@ComponentScan(basePackages = {&quot;com.example.demo2&quot;, &quot;com.example.demo1.logic&quot;})</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-01-04 00:23:49.949  INFO 10644 --- [           main] com.example.demo2.Demo2Application       : Starting Demo2Application on park-PC with PID 10644 (started by park <span class="keyword">in</span> D:\Dropbox\프리랜서\2020\demo2)</span><br><span class="line">2020-01-04 00:23:49.954  INFO 10644 --- [           main] com.example.demo2.Demo2Application       : No active profile <span class="built_in">set</span>, falling back to default profiles: default</span><br><span class="line">2020-01-04 00:23:51.010  INFO 10644 --- [           main] com.example.demo2.Demo2Application       : Started Demo2Application <span class="keyword">in</span> 1.862 seconds (JVM running <span class="keyword">for</span> 3.134)</span><br><span class="line">2020-01-04 00:23:51.012  INFO 10644 --- [           main] com.example.demo2.Demo2Application       : demo2 : tester.getValue() : demo2</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>com.example.demo1.logic</code> 으로 선언했을 경우 <code>Demo1Application</code> 이 실행되지 않는것을 확인할 수 있다.</p>
</blockquote>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Java/">Java</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Java-Spring-Spring-Boot/">Java, Spring, Spring Boot</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/12/16/Spring-Boot와-함께하는-Pivotal-Gemfire-간단예제-2/"><span>Spring Boot와 함께하는 Pivotal Gemfire 간단예제(2)</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/12/16/Spring-Boot와-함께하는-Pivotal-Gemfire-간단예제-2/" rel="bookmark">
        <time class="entry-date published" datetime="2019-12-15T15:22:01.000Z">
          2019-12-16
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="목차"><a href="#목차" class="headerlink" title="목차"></a>목차</h2><ol>
<li>Pivotal Gemfire 다운로드 및 설치, 기본 설정</li>
<li><strong><code>Spring Boot를 이용한 Gemfire 이용</code></strong></li>
</ol>
<p>지난시간에 이어서 간단한 테스트용 Region 생성과 Data 를 Region 안에 넣고 빼는 샘플 프로젝트를 제작해보자.</p>
<p>완성된 소스는 여기서 확인 가능하다.</p>
<p><a href="https://github.com/Park-jihoon/gemfire-demo" target="_blank" rel="noopener">https://github.com/Park-jihoon/gemfire-demo</a></p>
<h2 id="Region-생성"><a href="#Region-생성" class="headerlink" title="Region 생성"></a>Region 생성</h2><p>우선 gfsh 를 이용해 region 을 생성하자. region은 일반적인 DataBase로 치면 Table과 비슷한 역할을 하는 것으로 생성 시 많은 옵션을 줄 수 있다.</p>
<p>생성시 옵션은 대략 아래와 같다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">create region --name=value [--<span class="built_in">type</span>=value] [--template-region=value]</span><br><span class="line">    [--groups=value(,value)*] [--<span class="keyword">if</span>-not-exists(=value)?]</span><br><span class="line">    [--key-constraint=value] [--value-constraint=value]</span><br><span class="line">    [--<span class="built_in">enable</span>-statistics=value] [--entry-idle-time-expiration=value]</span><br><span class="line">    [--entry-idle-time-expiration-action=value]</span><br><span class="line">    [--entry-time-to-live-expiration=value]</span><br><span class="line">    [--entry-time-to-live-expiration-action=value]</span><br><span class="line">    [--entry-idle-time-custom-expiry=value] [--entry-time-to-live-custom-expiry=value]</span><br><span class="line">    [--region-idle-time-expiration=value]</span><br><span class="line">    [--region-idle-time-expiration-action=value]</span><br><span class="line">    [--region-time-to-live-expiration=value]</span><br><span class="line">    [--region-time-to-live-expiration-action=value] [--disk-store=value]</span><br><span class="line">    [--<span class="built_in">enable</span>-synchronous-disk=value] [--<span class="built_in">enable</span>-async-conflation=value]</span><br><span class="line">    [--<span class="built_in">enable</span>-subscription-conflation=value] [--cache-listener=value(,value)*]</span><br><span class="line">    [--cache-loader=value] [--cache-writer=value]</span><br><span class="line">    [--async-event-queue-id=value(,value)*]</span><br><span class="line">    [--gateway-sender-id=value(,value)*] [--<span class="built_in">enable</span>-concurrency-checks=value]</span><br><span class="line">    [--<span class="built_in">enable</span>-cloning=value] [--concurrency-level=value]</span><br><span class="line">    [--colocated-with=value] [--<span class="built_in">local</span>-max-memory=value]</span><br><span class="line">    [--recovery-delay=value] [--redundant-copies=value]</span><br><span class="line">    [--startup-recovery-delay=value] [--total-max-memory=value]</span><br><span class="line">    [--total-num-buckets=value] [--compressor=value] [--off-heap(=value)]</span><br><span class="line">    [--partition-resolver=value] [--eviction-entry-count=value]</span><br><span class="line">    [--eviction-max-memory=value] [--eviction-action=value] [--eviction-object-sizer=value]</span><br></pre></td></tr></table></figure>

<p>우선 region 생성 시 필수값인 <code>name</code>과 <code>type</code>만 살펴보자.</p>
<ul>
<li>name<ul>
<li>region을 해당 값의 이름으로 생성한다.</li>
<li>DB의 tableName과 유사</li>
</ul>
</li>
<li>type<ul>
<li><code>PARTITION</code>, <code>PARTITION_REDUNDANT</code>, <code>REPLICATE</code>, <code>LOCAL</code>, etc.</li>
<li>region type 에 따라 많은 타입이 존재하며 원하는 형태의 저장타입을 지정하면 된다.</li>
</ul>
</li>
</ul>
<p>이번 샘플에서는 아래의 두가지 region만 생성해본다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gfsh&gt;create region --name=testCache --<span class="built_in">type</span>=REPLICATE</span><br><span class="line">Member  | Status | Message</span><br><span class="line">------- | ------ | ----------------------------------------</span><br><span class="line">server1 | OK     | Region <span class="string">"/testCache"</span> created on <span class="string">"server1"</span></span><br><span class="line"></span><br><span class="line">Cluster configuration <span class="keyword">for</span> group <span class="string">'cluster'</span> is updated.</span><br><span class="line">gfsh&gt;create region --name=customer --<span class="built_in">type</span>=REPLICATE</span><br><span class="line">Member  | Status | Message</span><br><span class="line">------- | ------ | ---------------------------------------</span><br><span class="line">server1 | OK     | Region <span class="string">"/customer"</span> created on <span class="string">"server1"</span></span><br><span class="line"></span><br><span class="line">Cluster configuration <span class="keyword">for</span> group <span class="string">'cluster'</span> is updated.</span><br></pre></td></tr></table></figure>

<h2 id="Spring-Boot-Sample-생성"><a href="#Spring-Boot-Sample-생성" class="headerlink" title="Spring Boot Sample 생성"></a>Spring Boot Sample 생성</h2><ul>
<li>환경<ul>
<li>java 1.8 이상</li>
<li>Maven</li>
<li>Spring boot 2.1.1.RELEASE</li>
<li>Spring geode starter 1.2.1.RELEASE</li>
<li>SpringFox Swagger 2.9.2</li>
</ul>
</li>
</ul>
<h3 id="Directory-구조"><a href="#Directory-구조" class="headerlink" title="Directory 구조"></a>Directory 구조</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Gemfire-demo</span><br><span class="line">|-- pom.xml</span><br><span class="line">`-- src</span><br><span class="line">    `-- main</span><br><span class="line">        `-- java</span><br><span class="line">            `-- ko.co.pohinian.gemfiredemo</span><br><span class="line">                |-- GemfireDemoApplication.java</span><br><span class="line">                |-- configuration</span><br><span class="line">                |   |-- GemfireConfiguration.java</span><br><span class="line">                |   `-- SwaggerConfiguration.java</span><br><span class="line">                |-- controller</span><br><span class="line">                |   |-- CustomerController.java</span><br><span class="line">                |   `-- TestCacheController.java</span><br><span class="line">                |-- entity</span><br><span class="line">                |   |-- Customer.java</span><br><span class="line">                |   `-- TestCache.java</span><br><span class="line">                |-- repository</span><br><span class="line">                |   `-- CustomerRepository.java</span><br><span class="line">                `-- service</span><br><span class="line">                    `-- TestCacheService.java</span><br></pre></td></tr></table></figure>

<h3 id="파일-설명"><a href="#파일-설명" class="headerlink" title="파일 설명"></a>파일 설명</h3><p><code>pom.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- gemfire --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.geode<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-geode-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- swagger2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- swagger2 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- lombok --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- test --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- test --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>geode</code>와 <code>swagger2</code> 관련 라이브러리는 버전을 명시해야 한다.</p>
</blockquote>
<p><code>GemfireDemoApplication.java</code><br>실행을 위한 클래스를 생성한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GemfireDemoApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GemfireDemoApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><code>GemfireConfiguration.java</code></p>
<p><code>gemfire</code>를 사용하기 위한 설정을 모아두는 클래스 입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableGemfireCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GemfireConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientCache <span class="title">gemfireCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ClientCacheFactory cacheFactory = <span class="keyword">new</span> ClientCacheFactory();</span><br><span class="line">        cacheFactory.addPoolLocator(<span class="string">"192.168.0.6"</span>, <span class="number">10334</span>);</span><br><span class="line">        <span class="keyword">return</span> cacheFactory.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"testCache"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientRegionFactoryBean&lt;String, TestCache&gt; <span class="title">testCache</span><span class="params">(@Autowired ClientCache clientCache)</span> </span>&#123;</span><br><span class="line">        ClientRegionFactoryBean&lt;String, TestCache&gt; regionFactoryBean = <span class="keyword">new</span> ClientRegionFactoryBean&lt;&gt;();</span><br><span class="line">        regionFactoryBean.setCache(clientCache);</span><br><span class="line">        regionFactoryBean.setClose(<span class="keyword">false</span>);</span><br><span class="line">        regionFactoryBean.setShortcut(ClientRegionShortcut.PROXY);</span><br><span class="line">        <span class="keyword">return</span> regionFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"customer"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientRegionFactoryBean&lt;Long, Customer&gt; <span class="title">customer</span><span class="params">(@Autowired ClientCache clientCache)</span> </span>&#123;</span><br><span class="line">        ClientRegionFactoryBean&lt;Long, Customer&gt; regionFactoryBean = <span class="keyword">new</span> ClientRegionFactoryBean&lt;&gt;();</span><br><span class="line">        regionFactoryBean.setCache(clientCache);</span><br><span class="line">        regionFactoryBean.setClose(<span class="keyword">false</span>);</span><br><span class="line">        regionFactoryBean.setShortcut(ClientRegionShortcut.PROXY);</span><br><span class="line">        <span class="keyword">return</span> regionFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>@EnableGemfireCaching</code> 으로 gemfire cache를 사용할 것임을 명시한다.</li>
<li><code>gemfireCache()</code>에서 연결하기위한 Gemfire 서버의 정보를 설정한다.<ul>
<li><code>192.168.0.6</code>은 이전 글에서 시작한 locator 정보의 ip이다.</li>
<li>기본 local 접속이기때문에 별도의 username 과 password 는 설정하지 않는다. 하지만 별도의 서버를 구성할 경우에는 서버의 gemfire username과 password를 추가해야 한다.</li>
</ul>
</li>
<li><code>customer</code>와 <code>testCache</code>는 동명의 <code>region</code>에 대한 정보를 입력한다.</li>
<li><code>ClientRegionShortcut.PROXY</code>는 애플리케이션에서 저장되는 정보를 어떠한 방식으로 처리할지를 지정하는 것으로 기본값음 <code>LOCAL</code>이다. <code>LOCAL</code>인 경우 값을 애플리케이션에서만 가지고 있게 되며 서버로 전송하지 않는다.<ul>
<li>별도의 서버를 두고 데이터를 공유할 경우에는 <code>PROXY</code>로 지정해줘야 한다.</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="Customer-저장-및-로드"><a href="#Customer-저장-및-로드" class="headerlink" title="Customer 저장 및 로드"></a>Customer 저장 및 로드</h3><p>Customer 는 <code>org.springframework.data.repository.CrudRepository</code>를 사용하여 데이터를 저장 및 삭제하는 예제다.</p>
<p><code>Customer.java</code><br>region 정보를 명시해주는 클래스다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Region</span>(<span class="string">"customer"</span>)</span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span>(staticName = <span class="string">"newCustomer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Serializable</code>은 java 끼리만 gemfire의 데이터를 공유할 경우에 사용하면 간편하다.<br>다만 다른 언어들과 데이터를 공유할 경우에는 <code>DataSerializable</code> 등을 구현하여줘야 한다.</p>
</blockquote>
<p><code>CustomerRepository.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerRepository</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Customer</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Customer의 ID 타입인 Long 을 명시해준다.<br>gemfire 이외의 기술을 선택할 경우를 대비해 유연하도록 <code>CrudRepository</code>를 구현해준다.<br>findByName 등 jpa 에서 사용하던 형태의 메서드를 선언해 사용 가능하다.</p>
</blockquote>
<p><code>CustomerController.java</code></p>
<p>Customer 의 정보를 저장하기 위한 Rest Controller 이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CustomerRepository customerRepository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerController</span><span class="params">(CustomerRepository customerRepository)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerRepository = customerRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"&#123;key&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">put</span><span class="params">(@PathVariable(<span class="string">"key"</span>)</span> Long key, @RequestBody String name) </span>&#123;</span><br><span class="line">        Customer customer = Customer.newCustomer(key, name);</span><br><span class="line">        <span class="keyword">return</span> customerRepository.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"&#123;key&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">get</span><span class="params">(@PathVariable(<span class="string">"key"</span>)</span> Long key) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerRepository.findById(key).orElse(<span class="keyword">new</span> Customer());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>@RestController</code>는 RestApi로 사용하기 위해 선언한다.<br><code>CustomerRepository</code>의 Save 및 findById를 사용한다.</p>
<ul>
<li>save와 findById는 자동으로 생성된다.<br><code>Customer.newCustomer(key, name)</code> 입력된 값으로 저장을 위한 신규 객체를 생성한다.<br><code>orElse(new Customer())</code> 값이 존재하지 않을 경우 빈 객체를 리턴한다.</li>
</ul>
</blockquote>
<h3 id="Customer-테스트"><a href="#Customer-테스트" class="headerlink" title="Customer 테스트"></a>Customer 테스트</h3><ul>
<li>저장테스트</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; curl -X POST <span class="string">"http://localhost:8080/customer/1"</span> -H <span class="string">"accept: */*"</span> -H <span class="string">"Content-Type: application/json"</span> -d <span class="string">"테스트"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"id"</span>: 1,</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"테스트"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>저장한 값을 리턴한다.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; curl -X GET <span class="string">"http://localhost:8080/customer/1"</span> -H <span class="string">"accept: */*"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"id"</span>: 1,</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"테스트"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Region 정보 확인</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gfsh&gt;describe region --name=customer</span><br><span class="line">Name            : customer</span><br><span class="line">Data Policy     : replicate</span><br><span class="line">Hosting Members : server1</span><br><span class="line"></span><br><span class="line">Non-Default Attributes Shared By Hosting Members</span><br><span class="line"></span><br><span class="line"> Type  |    Name     | Value</span><br><span class="line">------ | ----------- | ---------------</span><br><span class="line">Region | data-policy | REPLICATE</span><br><span class="line">       | size        | 1</span><br><span class="line">       | scope       | distributed-ack</span><br></pre></td></tr></table></figure>


<h3 id="TestCache-저장-및-로드"><a href="#TestCache-저장-및-로드" class="headerlink" title="TestCache 저장 및 로드"></a>TestCache 저장 및 로드</h3><p>TestCache는 <code>org.springframework.cache</code>를 이용해 최소한의 설정값 만으로 Gemfire를 사용하기 위한 예제이다.</p>
<p><code>TestCache.java</code></p>
<p>TestCache는 일반적인 java entity 파일이다. 별도의 gemfire를 위한 설정은 존재하지 않는다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCache</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String addr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TestCacheService.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCacheService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CachePut</span>(cacheNames = <span class="string">"testCache"</span>, key = <span class="string">"#key"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TestCache <span class="title">put</span><span class="params">(String key, TestCache testCache)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> testCache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable</span>(cacheNames = <span class="string">"testCache"</span>, key = <span class="string">"#key"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TestCache <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>@CachePut</code>, <code>@Cacheable</code> 등 Spring Cache 를 이용해 Gemfire 의 Region에 데이터를 저장 및 로드 가능하다.<br>반드시 <code>@Service</code> 레벨이어야 한다. 또한, proxy 패턴을 이용하는 것이므로 같은 Class 내부에서 호출하는 부분은 캐싱되지않는다.<br><code>cacheNames = &quot;testCache&quot;</code> 으로 <code>region</code>의 이름을 명시한다.<br><code>key = &quot;#key&quot;</code>와 같이 매개변수명을 조합해 key를 지정할 수 있다.</p>
</blockquote>
<p><code>TestCacheController.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"cache"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCacheController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TestCacheService testCacheService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestCacheController</span><span class="params">(TestCacheService testCacheService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.testCacheService = testCacheService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"&#123;key&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TestCache <span class="title">put</span><span class="params">(@PathVariable(<span class="string">"key"</span>)</span> String key, @RequestBody TestCache value) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> testCacheService.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"&#123;key&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TestCache <span class="title">get</span><span class="params">(@PathVariable(<span class="string">"key"</span>)</span> String key) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> testCacheService.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TestCacheService</code>를 이용해 데이터를 저장 및 로드 한다.</p>
</blockquote>
<h3 id="TestCache-테스트"><a href="#TestCache-테스트" class="headerlink" title="TestCache 테스트"></a>TestCache 테스트</h3><ul>
<li>저장</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; curl -X POST <span class="string">"http://localhost:8080/cache/1"</span> -H <span class="string">"accept: */*"</span> -H <span class="string">"Content-Type: application/json"</span> -d <span class="string">"&#123; \"addr\": \"테스트주소\", \"name\": \"테스트이름\"&#125;"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"테스트이름"</span>,</span><br><span class="line">  <span class="string">"addr"</span>: <span class="string">"테스트주소"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>로드</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">"http://localhost:8080/cache/1"</span> -H <span class="string">"accept: */*"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"테스트이름"</span>,</span><br><span class="line">  <span class="string">"addr"</span>: <span class="string">"테스트주소"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Region 정보 확인</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gfsh&gt;describe region --name=testCache</span><br><span class="line">Name            : testCache</span><br><span class="line">Data Policy     : replicate</span><br><span class="line">Hosting Members : server1</span><br><span class="line"></span><br><span class="line">Non-Default Attributes Shared By Hosting Members</span><br><span class="line"></span><br><span class="line"> Type  |    Name     | Value</span><br><span class="line">------ | ----------- | ---------------</span><br><span class="line">Region | data-policy | REPLICATE</span><br><span class="line">       | size        | 1</span><br><span class="line">       | scope       | distributed-ack</span><br></pre></td></tr></table></figure>

<p>저장된 것을 확인할 수 있다.</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><p><a href="https://gemfire.docs.pivotal.io/99/gemfire/tools_modules/gfsh/chapter_overview.html" target="_blank" rel="noopener">gfsh(gemfire.docs.pivotal.io)</a></p>
</li>
<li><p><a href="https://gemfire.docs.pivotal.io/99/geode/developing/region_options/region_types.html" target="_blank" rel="noopener">Region Types(gemfire.docs.pivotal.io)</a></p>
</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Java/">Java</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Java-Spring-Spring-Boot-Gemfire/">Java, Spring, Spring Boot, Gemfire</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/12/10/Spring-Boot와-함께하는-Pivotal-Gemfire-간단예제(1)/"><span>Spring Boot와 함께하는 Pivotal Gemfire 간단예제(1)</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/12/10/Spring-Boot와-함께하는-Pivotal-Gemfire-간단예제(1)/" rel="bookmark">
        <time class="entry-date published" datetime="2019-12-10T14:21:25.000Z">
          2019-12-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="목차"><a href="#목차" class="headerlink" title="목차"></a>목차</h2><ol>
<li><strong><code>Pivotal Gemfire 다운로드 및 설치, 기본 설정</code></strong></li>
<li>Spring Boot를 이용한 Gemfire 이용</li>
</ol>
<p>갑작스럽지만 애플리케이션의 Cache를 담당해주던 Redis를 Pivotal Gemfire 로 변경하기로 했다. </p>
<p>이런 결정에는 몇가지 이유가 존재했는데.</p>
<ul>
<li>현재 프로젝트에서 사용하는 클라우드 환경은 PCF(Pivotal Cloud Foundry)로 <code>Gemfire</code>를 기반으로 하는 PCC(Pivotal Cloud Cache)를 간편하게 서비스로 등록 및 사용할 수 있다.</li>
<li>여건상 Redis 를 사용할 경우 PCF 환경의 외부에 Redis 서버가 존재할 수 밖에 없었다.</li>
</ul>
<p>이왕 Pivotal 제품인 PCF 를 쓰는거 끝까지 Pivotal 제품을 사용하기로 맘 먹은 부분도 크다. (기술 지원의 일원화?!)</p>
<h2 id="1-1-Pivotal-Gemfire-란"><a href="#1-1-Pivotal-Gemfire-란" class="headerlink" title="1.1. Pivotal Gemfire 란"></a>1.1. Pivotal Gemfire 란</h2><p><code>Pivotal GemFire</code>는 글로벌 레벨로 데이터 동기화가 가능한 <strong>인 메모리 데이터 그리드(In-Memory Data Grid)</strong>다. <em>오픈소스 버전으로는 <a href="https://geode.apache.org/" target="_blank" rel="noopener"><code>Apache Geode</code></a>가 존재한다.</em></p>
<p>주요기능을 요약하자면 다음과 같다.</p>
<ul>
<li>읽기-쓰기 처리량이 높음.(High Read-and-Write Throughput)</li>
<li>대기 시간이 낮으면서 예측 가능.(Low and Predictable Latency)</li>
<li>높은 확장성.(High Scalability)</li>
<li>지속적인 가용성.(Continuous Availability)</li>
<li>안정적인 이벤트 알림.(Reliable Event Notifications)</li>
<li>데이터 저장소 상의 병렬화 된 애플리케이션 동작.(Parallelized Application Behavior on Data Stores)</li>
<li>비공유 데이터 지속성.(Shared-Nothing Disk Persistence)</li>
<li>소유 비용 절감(Reduced Cost of Ownership)</li>
<li>클라이언트 / 서버를위한 단일 홉 기능(Single-Hop Capability for Client/Server)</li>
<li>클라이언트 / 서버 보안(Client/Server Security)</li>
<li>멀티 사이트 데이터 배포(Multisite Data Distribution)</li>
<li>연속 쿼리(Continuous Querying)</li>
<li>이기종 데이터 공유(Heterogeneous Data Sharing)</li>
</ul>
<blockquote>
<p>참고 : <a href="https://gemfire.docs.pivotal.io/99/geode/getting_started/product_intro.html" target="_blank" rel="noopener">Gemfire Main Features</a></p>
</blockquote>
<p>단순 Cache로 쓰기에는 넘쳐 흐르는 기능이 아닐 수 없다.</p>
<h2 id="1-2-Gemfire-다운로드"><a href="#1-2-Gemfire-다운로드" class="headerlink" title="1.2. Gemfire 다운로드"></a>1.2. Gemfire 다운로드</h2><p>Windows 운영체제 기반으로 설명한다.<br>나머지 운영체제의 설치는 <a href="https://gemfire.docs.pivotal.io/99/gemfire/getting_started/installation/install_intro.html" target="_blank" rel="noopener">여기서</a> 확인 가능하다.</p>
<ul>
<li>Pivotal 홈페이지에서 Gemfire 최신버전 다운로드<ul>
<li>Gemfire 9.9.0  <a href="https://network.pivotal.io/products/pivotal-gemfire#/releases/503604" target="_blank" rel="noopener">다운로드</a></li>
</ul>
</li>
</ul>
<img src="/2019/12/10/Spring-Boot%EC%99%80-%ED%95%A8%EA%BB%98%ED%95%98%EB%8A%94-Pivotal-Gemfire-%EA%B0%84%EB%8B%A8%EC%98%88%EC%A0%9C(1)/gemfire1.PNG" class="">

<ul>
<li>원하는 폴더로 압축파일을 해제</li>
</ul>
<img src="/2019/12/10/Spring-Boot%EC%99%80-%ED%95%A8%EA%BB%98%ED%95%98%EB%8A%94-Pivotal-Gemfire-%EA%B0%84%EB%8B%A8%EC%98%88%EC%A0%9C(1)/gemfire2.PNG" class="">

<ul>
<li>bin 폴더를 path 에 추가.</li>
</ul>
<img src="/2019/12/10/Spring-Boot%EC%99%80-%ED%95%A8%EA%BB%98%ED%95%98%EB%8A%94-Pivotal-Gemfire-%EA%B0%84%EB%8B%A8%EC%98%88%EC%A0%9C(1)/gemfire3.PNG" class="">

<h2 id="1-3-GFSH-실행-및-로컬-실행"><a href="#1-3-GFSH-실행-및-로컬-실행" class="headerlink" title="1.3. GFSH 실행 및 로컬 실행"></a>1.3. GFSH 실행 및 로컬 실행</h2><ul>
<li>명령 프롬프트 창 열기</li>
<li>gfsh(Gemfire Shell) 실행</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Microsoft Windows [Version 10.0.18362.476]</span><br><span class="line">(c) 2019 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users\park&gt;gfsh</span><br><span class="line">    _________________________     __</span><br><span class="line">   / _____/ ______/ ______/ /____/ /</span><br><span class="line">  / /  __/ /___  /_____  / _____  /</span><br><span class="line"> / /__/ / ____/  _____/ / /    / /</span><br><span class="line">/______/_/      /______/_/    /_/    9.9.0</span><br><span class="line"></span><br><span class="line">Monitor and Manage Pivotal GemFire</span><br><span class="line">gfsh&gt;</span><br></pre></td></tr></table></figure>

<p>간단하다.</p>
<p>실행을 위해서는 locator 와 server 를 기동해야 한다.</p>
<ul>
<li>locator 기동</li>
</ul>
<p><code>gfsh&gt;start locator --name=locator1</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gfsh&gt;start locator --name=locator1</span><br><span class="line">Starting a Geode Locator <span class="keyword">in</span> C:\Users\park\locator1...</span><br><span class="line">..</span><br><span class="line">Locator <span class="keyword">in</span> C:\Users\park\locator1 on park-PC[10334] as locator1 is currently online.</span><br><span class="line">Process ID: 19028</span><br><span class="line">Uptime: 1 minute 1 second</span><br><span class="line">Geode Version: 9.9.0</span><br><span class="line">Java Version: 1.8.0_77</span><br><span class="line">Log File: C:\Users\park\locator1\locator1.log</span><br><span class="line">JVM Arguments: -Dgemfire.enable-cluster-configuration=<span class="literal">true</span> -Dgemfire.load-cluster-configuration-from-dir=<span class="literal">false</span> -Dgemfire.launcher.registerSignalHandlers=<span class="literal">true</span> -Djava.awt.headless=<span class="literal">true</span> -Dsun.rmi.dgc.server.gcInterval=9223372036854775806</span><br><span class="line">Class-Path: D:\workspace\pivotal-gemfire-9.9.0\lib\geode-core-9.9.0.jar;D:\workspace\pivotal-gemfire-9.9.0\lib\geode-dependencies.jar</span><br><span class="line"></span><br><span class="line">Successfully connected to: JMX Manager [host=park-PC, port=1099]</span><br><span class="line"></span><br><span class="line">Cluster configuration service is up and running.</span><br></pre></td></tr></table></figure>

<ul>
<li>server 기동</li>
</ul>
<p><code>gfsh&gt;start server --name=server1</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gfsh&gt;start server --name=server1</span><br><span class="line">Starting a Geode Server <span class="keyword">in</span> C:\Users\park\server1...</span><br><span class="line">..</span><br><span class="line">Server <span class="keyword">in</span> C:\Users\park\server1 on park-PC[40404] as server1 is currently online.</span><br><span class="line">Process ID: 10964</span><br><span class="line">Uptime: 1 minute 1 second</span><br><span class="line">Geode Version: 9.9.0</span><br><span class="line">Java Version: 1.8.0_77</span><br><span class="line">Log File: C:\Users\park\server1\server1.log</span><br><span class="line">JVM Arguments: -Dgemfire.default.locators=192.168.0.6[10334] -Dgemfire.start-dev-rest-api=<span class="literal">false</span> -Dgemfire.use-cluster-configuration=<span class="literal">true</span> -XX:OnOutOfMemoryError=taskkill /F /PID %p -Dgemfire.launcher.registerSignalHandlers=<span class="literal">true</span> -Djava.awt.headless=<span class="literal">true</span> -Dsun.rmi.dgc.server.gcInterval=9223372036854775806</span><br><span class="line">Class-Path: D:\workspace\pivotal-gemfire-9.9.0\lib\geode-core-9.9.0.jar;D:\workspace\pivotal-gemfire-9.9.0\lib\geode-dependencies.jar</span><br></pre></td></tr></table></figure>

<ul>
<li>locator와 server 기동 확인</li>
</ul>
<p><code>gfsh&gt;list members</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gfsh&gt;list members</span><br><span class="line">Member Count : 2</span><br><span class="line"></span><br><span class="line">  Name   | Id</span><br><span class="line">-------- | ---------------------------------------------------------------</span><br><span class="line">locator1 | 192.168.0.6(locator1:19028:locator)&lt;ec&gt;&lt;v0&gt;:41000 [Coordinator]</span><br><span class="line">server1  | 192.168.0.6(server1:10964)&lt;v1&gt;:41001</span><br></pre></td></tr></table></figure>

<p>여기까지가 Gemfire 기동 준비다.</p>
<p>다음에는 Gemifre 의 Table 이라고 할 수 있는 <code>region</code> 생성과 간단히 Spring Boot 를 이용한 Spring Data Gemfire Cache 샘플 프로젝트를 만들어 보겠다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Java/">Java</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Java-Spring-Spring-Boot-Gemfire/">Java, Spring, Spring Boot, Gemfire</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/12/09/HTML-로-1px-미만-선-인쇄하기/"><span>HTML 로 1px 미만 선 인쇄하기</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/12/09/HTML-로-1px-미만-선-인쇄하기/" rel="bookmark">
        <time class="entry-date published" datetime="2019-12-09T14:47:38.000Z">
          2019-12-09
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h3 id="픽셀과-포인트"><a href="#픽셀과-포인트" class="headerlink" title="픽셀과 포인트"></a>픽셀과 포인트</h3><p>브라우저에서 선을 표현하는 단위는 대부분 px 입니다. 픽셀이죠. 이는 <code>상대적인 값</code>입니다. 디지털 이미지를 화면에 재현하기 위한 단위로, 이미지를 이루는 가장 작은 단위를 뜻합니다.</p>
<p>픽셀을 많이 표현할 수 있다. = 해상도가 높다. 로 표현할 수 있으며, 이는 더 정교하게 이미지를 표현할 수 있다는 것을 의미합니다.</p>
<p>즉, 픽셀은 모니터의 해상도, 크기 및 OS(windows, MAC OS) 등에 따라 바뀔 수 있는 상대적인 값임을 알 수 있습니다.</p>
<p>하지만 인쇄의 영역에서 사용하는 단위인 pt는 다릅니다. 포인트라고 불리는 값은 <code>절대적인 값</code>입니다. 1인치를 72로 나눈 값으로 1pt = 1/72 inch = 약 0.3527 입니다.</p>
<p>오늘은 px로 표현한 웹 문서를 가지고 인쇄물로 출력하면서 발생한 이슈에 대해 이야기해보겠습니다.</p>
<h3 id="굵은-1px"><a href="#굵은-1px" class="headerlink" title="굵은 1px"></a>굵은 1px</h3><p>1px 굵기의 선으로 구성된 통계표를 출력해 받아본 고객에게서 다음과 같은 반응이 나왔습니다.</p>
<blockquote>
<p>프린트 해서 봤더니 선이 너무 굵어요. 좀 더 얇게 해주세요.</p>
</blockquote>
<p>당초 계획은 통계표를 웹에서 구성한 뒤 PDF파일로 제공하고, PDF파일을 고객이 프린터로 출력해서 제본하는 것이었습니다. 하지만 고객이 받아본 통계표 PDF는 고객 기준으로는 <strong>매우 굵은</strong> 선을 가지고 있었습니다.</p>
<p>다시 말하지만 통계표(table)의 선 굵기(border)는 1px 이었습니다.</p>
<p>간단한 html로 표현해보자.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-tag">table</span><span class="selector-class">.one</span> &#123;</span></span><br><span class="line">	border: solid black 1px;</span><br><span class="line">	border-collapse: collapse;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-tag">td</span><span class="selector-class">.one</span> &#123;</span></span><br><span class="line">	border: solid black 1px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span>가나다라<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>검은색 1px 굵기의 선을 가진 테이블 입니다. 아래와 같이 표현됩니다.</p>
<img src="/2019/12/09/HTML-%EB%A1%9C-1px-%EB%AF%B8%EB%A7%8C-%EC%84%A0-%EC%9D%B8%EC%87%84%ED%95%98%EA%B8%B0/table1.PNG" class="" title="간단한 테이블 1px">

<p>얼핏 보기에는 얇아보이는 선입니다. 하지만 A4용지 혹은 B4용지로 출력해서 살펴본 고객은 한글(HWP)로 제작된 표에 비해 선이 굵어보인다고 했습니다. 실제로 양쪽 출력물을 비교해봐도 HTML 기반 출력물이 더 굵었습니다. 이때까지는 단순하게 생각했습니다.</p>
<blockquote>
<p>0.5px 정도 주면 해결되겠네.</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-tag">table</span><span class="selector-class">.one</span> &#123;</span></span><br><span class="line">	border: solid black 1px;</span><br><span class="line">	border-collapse: collapse;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-tag">td</span><span class="selector-class">.one</span> &#123;</span></span><br><span class="line">	border: solid black 1px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-tag">table</span><span class="selector-class">.two</span> &#123;</span></span><br><span class="line"><span class="css">	<span class="selector-tag">border</span>: <span class="selector-tag">solid</span> <span class="selector-tag">black</span> 0<span class="selector-class">.5px</span>;</span></span><br><span class="line">	border-collapse: collapse;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-tag">td</span><span class="selector-class">.two</span> &#123;</span></span><br><span class="line"><span class="css">	<span class="selector-tag">border</span>: <span class="selector-tag">solid</span> <span class="selector-tag">black</span> 0<span class="selector-class">.5px</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span>가나다라<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"two"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"two"</span>&gt;</span>가나다라<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"two"</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>two 라는 클래스의 table을 하나 더 생성한 뒤 선의 굵기를 0.5px 로 줬습니다. 단순히 1px의 절반 굵기의 선이 생성되기를 기대했습니다. 하지만 어림도 없지. 1px 이하의 굵기는 화면에서 표현할 수 없는게 당연했습니다. (표현의 최소 단위니까…)</p>
<img src="/2019/12/09/HTML-%EB%A1%9C-1px-%EB%AF%B8%EB%A7%8C-%EC%84%A0-%EC%9D%B8%EC%87%84%ED%95%98%EA%B8%B0/table2.PNG" class="" title="간단한 테이블 0.5px?">

<p>물론 일반적인 해상도로 봤을 때는 동일해보이지만 확대를 하게되면 두 테이블은 확연히 다른 선 굵기를 가지고 있음을 알 수 있습니다.</p>
<img src="/2019/12/09/HTML-%EB%A1%9C-1px-%EB%AF%B8%EB%A7%8C-%EC%84%A0-%EC%9D%B8%EC%87%84%ED%95%98%EA%B8%B0/%ED%99%95%EB%8C%80_table1.PNG" class="" title="확대 하니 다르다!">

<p>화면은 확대가 가능하지만 <code>출력물</code>은 확대를 할 수 없습니다. 슬슬 출력물에 대한 부담감이 몰려왔습니다. 하지만 막연히 PDF 또는 프린트 드라이버가 알아서 해주실거야! 라는 생각도 드는 순간 입니다.</p>
<p>아래는 위의 html을 PDF로 출력한 결과 입니다. (잘 안보일까봐 200% 확대 출력 했습니다.)</p>
<a href="/2019/12/09/HTML-%EB%A1%9C-1px-%EB%AF%B8%EB%A7%8C-%EC%84%A0-%EC%9D%B8%EC%87%84%ED%95%98%EA%B8%B0/1px_tables.pdf" title="[PDF로 확인해보자!]">[PDF로 확인해보자!]</a>


<p>하느님 맙소사. 출력된 pdf에는 0.5px 과 1px 이 모두 1px 로 표현되는 것을 확인할 수 있었습니다.</p>
<p>이리저리 찾아본 결과 chrome 에서 print pdf로 pdf 를 생성할 경우 1px 미만의 선은 제대로 표현이 되지 않는다는 정보가 있었습니다. 이는 현재 기준으로도 수정될 가능성이 없어보이는 이슈로 <code>headless chrome</code>라이브러리인 <code>puppeteer</code>를 이용한 pdf export 시에도 마찬가지로 발생하고 있었습니다.</p>
<h3 id="해결방안-테스트1-투명도"><a href="#해결방안-테스트1-투명도" class="headerlink" title="해결방안 테스트1 - 투명도"></a>해결방안 테스트1 - 투명도</h3><p>검색 결과 1px 미만의 선을 표현하기 위한 많은 개발자들의 노력과 답변들이 존재했습니다. 다만, 인쇄를 해야겠다라는 개발자는 많지 않았습니다.</p>
<p>우선 화면에서 표현이 된다는 CSS 트릭 부터 테스트해봤습니다. 바로 투명도를 이용한 방식 입니다.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.container</span> &#123;</span></span><br><span class="line">    border-style: solid;</span><br><span class="line">    border-width: 1px;</span><br><span class="line">    margin-bottom: 10px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.border-100</span> &#123;<span class="attribute">border-color</span>: <span class="built_in">rgba</span>(0,0,255,1);&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.border-75</span> &#123;<span class="attribute">border-color</span>: <span class="built_in">rgba</span>(0,0,255,0.75);&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.border-50</span> &#123;<span class="attribute">border-color</span>: <span class="built_in">rgba</span>(0,0,255,0.5);&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.border-25</span> &#123;<span class="attribute">border-color</span>: <span class="built_in">rgba</span>(0,0,255,0.25);&#125;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container border-100"</span>&gt;</span>1px<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container border-75"</span>&gt;</span>0.75px<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container border-50"</span>&gt;</span>0.5px<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container border-25"</span>&gt;</span>0.25px<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1px 미만의 선은 표현하기 어렵기 때문에 선의 투명도를 조절하여 얇게 보이도록 하는 트릭 입니다. 화면에서의 결과는 아래와 같습니다.</p>
<img src="/2019/12/09/HTML-%EB%A1%9C-1px-%EB%AF%B8%EB%A7%8C-%EC%84%A0-%EC%9D%B8%EC%87%84%ED%95%98%EA%B8%B0/%ED%88%AC%EB%AA%85%EB%8F%84.PNG" class="" title="그럴싸하다">

<p>모니터 너머로 보이는 선은 정말 얇아보입니다. 0.25px 정도는 억지스러워보이지만 0.5px 정도까지는 눈감고 넘어가줄만 합니다.</p>
<p>이제 인쇄만 이쁘게 되면 됩니다.</p>
<a href="/2019/12/09/HTML-%EB%A1%9C-1px-%EB%AF%B8%EB%A7%8C-%EC%84%A0-%EC%9D%B8%EC%87%84%ED%95%98%EA%B8%B0/%ED%88%AC%EB%AA%85%EB%8F%84.pdf" title="[PDF로 확인해보자!]">[PDF로 확인해보자!]</a>

<p>PDF로 출력된 선은 뚜꺼워 보였으며, 얇아지지도 않았습니다. 투명해져가는 선은 단순히 프린터의 잉크가 떨어진 것 처럼 보일 뿐이었습니다.</p>
<p>화면과 출력물은 다르다 라는 교훈만 얻게 되었습니다.</p>
<h3 id="해결방안-테스트2-background-image-속성"><a href="#해결방안-테스트2-background-image-속성" class="headerlink" title="해결방안 테스트2 - background-image 속성"></a>해결방안 테스트2 - background-image 속성</h3><p>CSS에는 border-image 속성이 존재합니다. 이는 image 파일을 border 에 줄 수 있는 것으로, HTML BOX를 디자인하기 좋아지는 속성 입니다. </p>
<p>구현은 간단하지 않은 관계로(현재 기억이 자세히 나지 않….) 히스토리만 적어보겠습니다.</p>
<ul>
<li>디자이너에게 0.5px 선 이미지를 요청해 받았습니다. (포토샵은 대단합니다.)</li>
<li>border-image 속성으로 표현합니다.</li>
<li>필요에 따라 회전 시키며 사용합니다.</li>
</ul>
<p>결과적으로는 PDF 상에 0.5px 를 표현하는데 성공했습니다. 이미지는 벡터로 랜더링 되는 선이 아니라 이미지 그 자체이기 때문에 문제가 없어 보였습니다.</p>
<p>다만 문제가 있었습니다.</p>
<p>구현 방식이 너무 복잡해, 수시로 편집 및 병합이 될 수 있는 통계표 테이블에 적용해주기는 어려웠던 것입니다. 때문에 절반의 성공으로 다음을 기약할 수 밖에 없었습니다.</p>
<h3 id="해결방안-테스트-3"><a href="#해결방안-테스트-3" class="headerlink" title="해결방안 테스트 3"></a>해결방안 테스트 3</h3><p>마지막 방법은 <code>@media print</code>를 이용해 print시 적용되는 css를 별도로 제작하는 것 입니다.<br>이 방법에는 약간의 트릭이 있습니다. </p>
<ul>
<li>PDF print시 1px 미만이 표현되지 않는 문제 회피 필요.</li>
<li><code>@media print</code> CSS에서 1px 미만의 숫자가 존재하지 않도록 기존의 CSS 수치에 일정 수치를 곱해준다.<ul>
<li>예&gt; 0.5px 이 가장 얇은 선일 경우 = 모든 수치를 2배</li>
<li>1px =&gt; 2px, 0.5px =&gt; 1px</li>
</ul>
</li>
<li>마지막으로 body 부분에 0.5배 축소 설정을 추가</li>
</ul>
<p>아래는 예 입니다.</p>
<p><code>@media screen</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen &#123;</span><br><span class="line">	<span class="selector-class">.container</span> &#123;</span><br><span class="line">		<span class="attribute">border-style</span>: solid;</span><br><span class="line">		<span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">		<span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">		<span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="selector-class">.border-100</span> &#123;<span class="attribute">border-width</span>:<span class="number">1px</span>&#125;</span><br><span class="line">	<span class="selector-class">.border-75</span> &#123;<span class="attribute">border-width</span>:<span class="number">0.75px</span>&#125;</span><br><span class="line">	<span class="selector-class">.border-50</span> &#123;<span class="attribute">border-width</span>:<span class="number">0.5px</span>&#125;</span><br><span class="line">	<span class="selector-class">.border-25</span> &#123;<span class="attribute">border-width</span>:<span class="number">0.25px</span>&#125;</span><br></pre></td></tr></table></figure>

<img src="/2019/12/09/HTML-%EB%A1%9C-1px-%EB%AF%B8%EB%A7%8C-%EC%84%A0-%EC%9D%B8%EC%87%84%ED%95%98%EA%B8%B0/%EA%B2%B0%EA%B3%BC_web.PNG" class="">


<p><code>@media print</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> print &#123;</span><br><span class="line">	<span class="selector-tag">body</span> &#123;</span><br><span class="line">		<span class="attribute">transform</span>: <span class="built_in">scale</span>(.25);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="selector-class">.container</span> &#123;</span><br><span class="line">		<span class="attribute">border-style</span>: solid;</span><br><span class="line">		<span class="attribute">border-width</span>: <span class="number">4px</span>;</span><br><span class="line">		<span class="attribute">margin-bottom</span>: <span class="number">40px</span>;</span><br><span class="line">		<span class="attribute">font-size</span>: <span class="number">56px</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="selector-class">.border-100</span> &#123;<span class="attribute">border-width</span>:<span class="number">4px</span>&#125;</span><br><span class="line">	<span class="selector-class">.border-75</span> &#123;<span class="attribute">border-width</span>:<span class="number">3.05px</span>&#125;</span><br><span class="line">	<span class="selector-class">.border-50</span> &#123;<span class="attribute">border-width</span>:<span class="number">2.5px</span>&#125;</span><br><span class="line">	<span class="selector-class">.border-25</span> &#123;<span class="attribute">border-width</span>:<span class="number">1px</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2019/12/09/HTML-%EB%A1%9C-1px-%EB%AF%B8%EB%A7%8C-%EC%84%A0-%EC%9D%B8%EC%87%84%ED%95%98%EA%B8%B0/%EA%B2%B0%EA%B3%BC_pdf.PNG" class="">

<p>문제없이 pdf 에서 원하는 굵기가 출력되는 것을 확인할 수 있었습니다.</p>
<h3 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h3><p>프로젝트에서는 세가지 방법 중 가장 만족도가 높았던 3안을 선택하여 제작했습니다. WEB의 화면을 PDF로 출력한다는 일반적이지 않은 작업이었지만 원하는 결과에 가까운 출력물을 얻을 수 있어 다행이었습니다.</p>
<p>모든 CSS의 굵기를 계산해서 만들어야 한다는 점이 어렵게 느껴질 수 있겠지만, SASS 등과 같이 CSS를 일괄 빌드할 수 있는 툴을 사용한다면 print CSS를 빠르게 생성할 수 있으니 충분히 쓸만해 보입니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Etc/">Etc</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/html/">html</a><a href="/tags/css/">css</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/11/28/Maven-Dependency-Scope의-종류/"><span>Maven Dependency Scope의 종류</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/11/28/Maven-Dependency-Scope의-종류/" rel="bookmark">
        <time class="entry-date published" datetime="2019-11-27T15:33:48.000Z">
          2019-11-28
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><code>Dependency(의존성)</code> 범위는 의존성의 <code>transitive(전이)</code>를 제한하고 다양한 빌드 작업에 사용되는 <code>classpath</code>에 영향을주기 위해 사용됩니다.</p>
<p>Maven에서 의존성을 선언하는 방법은 대략적으로 아래와 같습니다.</p>
<p><code>pom.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>foo-bar<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>$&#123;scope&#125;<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>의존성에는 총 6가지의 scope가 존재합니다.</p>
<ul>
<li><code>compile</code><ul>
<li>지정되지 않은 경우 사용되는 기본 <code>scope</code> 입니다. </li>
<li><code>Compile</code>로 선언된 dependencies는 프로젝트의 모든 <code>classpath</code>에서 사용할 수 있습니다. 또한 이러한 의존성은 종속 프로젝트로 전파됩니다.</li>
</ul>
</li>
<li><code>provided</code><ul>
<li><code>Compile</code>과 비슷하지만 프로잭트 실행 시 라이브러리에 대한 의존성을 <em>JDK</em> 또는 <em>container(ex.tomcat)</em> 가 제공 할 것으로 예상함을 나타냅니다. </li>
<li>예를 들자면, <em>Java Enterprise Edition</em> 용 <em>web Applicaton</em> 을 빌드할 경우 <em>web container</em> 가 <em>Servlet API</em> 및 관련 <em>Java EE API</em> 에 대한 class 및 의존성을 제공하므로 <code>provided</code>로 설정합니다. </li>
<li>이 scope는 compile 및 test 시에만 사용되며 전이되지 않습니다.</li>
</ul>
</li>
<li><code>runtime</code><ul>
<li><code>compile</code>에는 필요하지 않지만 실행 시 필요할 경우 사용합니다. </li>
<li><code>runtime</code>이 선언된 의존성은 <code>runtime</code> 과 <code>test</code> <em>classpath</em> 에 존재하지만 <code>compile</code> <em>classpath</em> 에는 존재하지 않습니다.</li>
</ul>
</li>
<li><code>test</code><ul>
<li><em>application</em> 을 정상적으로 사용하는데는 필요하지 않지만 <em>test 컴파일 또는 실행</em> 시 필요함을 의미합니다. </li>
<li>이 <code>scope</code>는 전이되지 않습니다.</li>
</ul>
</li>
<li><code>system</code><ul>
<li>이 <code>scope</code>는 명시 적으로 포함하는 <em>JAR</em> 을 제공해야한다는 점을 제외하고, <code>provided</code>와 유사합니다. </li>
<li><em>artifact</em> 는 항상 사용 가능하며 <em>repository</em> 에서는 검색되지 않습니다.</li>
</ul>
</li>
<li><code>import</code><ul>
<li><code>&lt;dependencyManagement&gt; 영역</code> 내부 <em>pom 타입의 의존성</em> 에만 지원됩니다.</li>
<li>다른 프로젝트에서 관리되는 의존성 목록을 가져오기 위해서 사용합니다.</li>
<li><code>import scope</code>로 선언된 <em>POM</em> 의 의존성 목록은 실제로 의존성의 전이에 참여하지 않습니다.</li>
</ul>
</li>
</ul>
<p>참고 : <a href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope" target="_blank" rel="noopener">http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Java/">Java</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/maven/">maven</a><a href="/tags/java/">java</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/11/27/Maven으로-Spring-boot-배포-시-repackge-방지/"><span>Maven으로 Spring boot 배포 시 repackge 방지</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/11/27/Maven으로-Spring-boot-배포-시-repackge-방지/" rel="bookmark">
        <time class="entry-date published" datetime="2019-11-26T16:21:12.000Z">
          2019-11-27
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="개요"><a href="#개요" class="headerlink" title="개요"></a>개요</h2><p>다른 프로젝트에서 Spring Boot Application 의 jar를 참조하여 사용하기 위해서는 Maven Deploy시 실행 가능한 jar가 아닌 Original jar 가 배포 되어야 함.</p>
<h2 id="Spring-Boot-Maven-Plugin"><a href="#Spring-Boot-Maven-Plugin" class="headerlink" title="Spring Boot Maven Plugin"></a>Spring Boot Maven Plugin</h2><p><code>Maven</code>을 이용하여 <code>Spring Boot Application</code>을 빌드 할 경우 특별한 경우가 아니라면 <code>Spring Boot Maven Plugin</code>을 활용하게 될겁니다. <code>Spring Boot Maven Plugin</code>은 아래와 같은 몇가지 기능을 제공합니다.</p>
<ul>
<li><code>repackage</code> : 자동 실행 가능한 jar 또는 war 파일을 만듭니다.</li>
<li><code>run</code> : Spring Boot Application이 매개변수를 전달하는 여러가지 옵션과 함께 실행됩니다.</li>
<li><code>start</code> and <code>stop</code> : Application 이 시작되기 전 <code>integration-test</code> 단계를 수행할 수 있습니다.</li>
<li><code>build-info</code> : Actuator가 사용할 수있는 빌드 정보를 생성합니다.</li>
</ul>
<p>이 중 이번에 살펴볼 부분은 <code>repackage</code> 입니다.</p>
<h2 id="Repackaging-an-application"><a href="#Repackaging-an-application" class="headerlink" title="Repackaging an application"></a>Repackaging an application</h2><p>간단한 예제 입니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>repackage</code>는 Maven 수명주기의 <code>package</code> 단계에서 빌드 된 jar 또는 war를 다시 패키지(repackage)합니다. Plugin은 Application을 <code>repackage</code> 하면서 프로젝트의 dependency를 참고하여 필요한(종속된) 라이브러리를 포함시킵니다. 때문에 용량이 매우 크죠. repackage 되기 전 jar 또는 war 는 <code>.original</code> 확장자가 추가로 붙어 보존 됩니다.</p>
<img src="/2019/11/27/Maven%EC%9C%BC%EB%A1%9C-Spring-boot-%EB%B0%B0%ED%8F%AC-%EC%8B%9C-repackge-%EB%B0%A9%EC%A7%80/original-jar.PNG" class="" title="jar와 jar.original 의 용량차이는 어마어마하다">

<p>실행 가능한 jar는 빌드 및 테스트시에 매우 유용합니다. 독립 실행이 가능하기 때문에 배포 역시 편리해지지요. 하지만 Application의 코드가 다른 프로젝트에서 사용되어야 한다면 어떨까요. 이런경우 다른 팀원과 공유해야 할 경우에 jar.original 파일을 건네주는 것은 의미가 없습니다.(다른 팀원도 Maven을 사용하고 있을테니까요.)</p>
<p>우리는 jar.original 파일을 사내 Maven Repository에 배포해야 합니다.</p>
<h2 id="Deploy-Maven-Repository"><a href="#Deploy-Maven-Repository" class="headerlink" title="Deploy Maven Repository"></a>Deploy Maven Repository</h2><p>여기서 사내 Maven Repository에 접근하기위한 Maven의 <code>settings.xml</code> 파일 설정 등의 설명은 하지 않겠습니다. 모든 설정이 잘 되어있다고 가정했을 경우 일반적인 배포 명령어는 아래와 같습니다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean deploy</span><br></pre></td></tr></table></figure>
<p>이제 pom.xml 에 dependency 설정만 해주면 되겠군요!</p>
<p>하지만 다른 팀원의 pom.xml에 정상적으로 dependency 설정을 완료하더라도 Class를 찾을 수 없다는 에러가 발생합니다. 이유는 간단합니다. <code>original jar</code>가 아닌 <code>실행가능한 jar</code>가 배포되었기 때문이죠. </p>
<p>실행가능한 jar(혹은 war)는 아래의 디렉토리 구조에서 알 수 있듯 jar.original과 다른 구조를 가지게 되며, dependency에 선언되더라도 Class를 찾을 수 없습니다.</p>
<img src="/2019/11/27/Maven%EC%9C%BC%EB%A1%9C-Spring-boot-%EB%B0%B0%ED%8F%AC-%EC%8B%9C-repackge-%EB%B0%A9%EC%A7%80/jar-directory.PNG" class="" title="실행가능한 jar의 폴더구조">

<p>또한, 실행이 되더라도 배포하기에는 너무나 거대한 용량을 가지게 되죠. 다른 팀원에게 제공되어야 하는 jar 는 실행이 가능하도록 repackage 되기 전의 결과물인 original jar 입니다.</p>
<h2 id="Spring-Boot-Maven-Plugin-repackage"><a href="#Spring-Boot-Maven-Plugin-repackage" class="headerlink" title="Spring Boot Maven Plugin:repackage"></a>Spring Boot Maven Plugin:repackage</h2><p>모든일의 원흉(?)이라고 할 수 있는 <code>Spring Boot Maven Plugin</code>의 <a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/repackage-mojo.html" target="_blank" rel="noopener"><code>repackage</code> 문서</a>를 살펴봅시다. <code>Optional Parameters</code>에 흥미로운 파라미터가 보입니다. 바로 <code>skip</code>이죠.</p>
<ul>
<li><code>skip</code><ul>
<li>Skip the execution.</li>
<li>Type: boolean</li>
<li>Since: 1.2.0</li>
<li>Required: No</li>
<li>User Property: spring-boot.repackage.skip</li>
<li>Default: false</li>
</ul>
</li>
</ul>
<p>실행을 Skip 할 수 있다는 군요. 해결책을 찾은 것 같습니다.</p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>Maven Deploy 시 Original jar 를 배포하기 위한 명령어는 다음과 같습니다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean deploy -Dspring-boot.repackage.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>참고 : <a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/repackage-mojo.html" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/current/maven-plugin/repackage-mojo.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Java/">Java</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Spring-Boot/">Spring Boot</a><a href="/tags/Maven/">Maven</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/08/29/Jenkins-Blue-Ocean-으로-배포하기/"><span>Jenkins Blue Ocean 으로 배포하기</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/08/29/Jenkins-Blue-Ocean-으로-배포하기/" rel="bookmark">
        <time class="entry-date published" datetime="2018-08-29T00:45:22.000Z">
          2018-08-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="Jenkins-란"><a href="#Jenkins-란" class="headerlink" title="Jenkins 란"></a>Jenkins 란</h1><h2 id="중요이슈"><a href="#중요이슈" class="headerlink" title="중요이슈"></a>중요이슈</h2><p>Windows 10 환경에서 Jenkins 로 SSH 를 이용한 배포를 하기 위해서는 SSH KEY가 필요하다.<br>원격지 서버에 ssh pub key 를 잘 등록하고<br>Git Bash 에서도 비밀번호 없이 ssh 가 원활하게 접속되는것을 확인했지만 이상하게도 Jenkins 상의 shell script 에서는 ssh 접속 명령 이후 멈춰버리는 현상이 발생했다.</p>
<ul>
<li>Git Bash 로는 접속 가능</li>
<li>Jenkins Job 에서는 접속 불가<ul>
<li>Blue Ocean 및 일반 Job 에서도 연결되지 않음.</li>
</ul>
</li>
</ul>
<p><del>원인을 파악하기 위해 비슷한 이슈를 구글링해보았지만 나오지 않았다…</del></p>
<h3 id="해결"><a href="#해결" class="headerlink" title="해결"></a>해결</h3><p>ssh 에 -vvv 옵션을 준 뒤 jenkins Job을 실행했다.<br>분명 SSH_Agent 를 사용했으며, SSH 인증 Credential 을 생성하여줬음에도 불구하고 id_rsa 파일을 엉뚱한 곳에서 찾으려고 노력하고 있었다. (털썩)<br>ssh keygen 을 Git Bash 에서 진행했기 때문에 id_rsa 파일은 <code>C:/Users/Park/.ssh</code> 폴더에 들어있었지만 Jenkins 에서 검색중인 폴더는 <code>C:\\WINDOWS\\system32\\config\\systemprofile/.ssh/</code> 였다. <del>이유가 뭐야….</del></p>
<ul>
<li><code>C:/Users/Park/.ssh</code> 내부의 파일을 복사</li>
<li><code>C:\\WINDOWS\\system32\\config\\systemprofile/.ssh/</code>로 이동</li>
</ul>
<p>해결완료.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Tool/">Tool</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Jenkins/">Jenkins</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/08/23/Intellij-단축키모음/"><span>IntelliJ 단축키모음</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/08/23/Intellij-단축키모음/" rel="bookmark">
        <time class="entry-date published" datetime="2018-08-23T07:23:00.000Z">
          2018-08-23
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h3 id="IntelliJ-단축키-모음"><a href="#IntelliJ-단축키-모음" class="headerlink" title="IntelliJ 단축키 모음"></a>IntelliJ 단축키 모음</h3><p>기본적인 단축키 모음입니다.<br>숙달되면 마우스 의존도가 좀 줄지 않을까 싶은데 맥과 윈도우를 모두 외우려니 여간 힘든게 아니군요… <del>맥을 버리면 편해지려나</del></p>
<p>java 개발자라면 강추 드리는 툴 입니다.</p>
<img src="/2018/08/23/Intellij-%EB%8B%A8%EC%B6%95%ED%82%A4%EB%AA%A8%EC%9D%8C/IntelliJ_ReferenceCard_Korea.jpg" class="">
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Tool/">Tool</a>, <a href="/categories/Tool/IntelliJ/">IntelliJ</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IntelliJ/">IntelliJ</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/08/22/git-Unlink-of-file-Failed-Should-I-try-again-문제-해결법/"><span>[Git]Unlink of file Failed. Should I try again? 문제 해결법</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/08/22/git-Unlink-of-file-Failed-Should-I-try-again-문제-해결법/" rel="bookmark">
        <time class="entry-date published" datetime="2018-08-22T04:06:13.000Z">
          2018-08-22
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h3 id="사건개요"><a href="#사건개요" class="headerlink" title="사건개요"></a>사건개요</h3><p>직장 후배가 <code>eclipse</code>의 <code>synchronize git</code>을 사용해 remote Server의 데이터를 <code>pull</code> 해오던 와중에 아무런 메시지 없이 데이터가 가져와지지 않는 현상이 발생했습니다.<br>평소 eclipse를 사용하지 않는 관계로 툴 내부에서 확인이 어려웠고 결국 git bash 를 열었습니다.</p>
<h3 id="git-bash"><a href="#git-bash" class="headerlink" title="git bash"></a>git bash</h3><p>우선 당겨와 보았습니다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull origin master</span></span><br></pre></td></tr></table></figure>

<p>데이터를 잘 가져오던 중 아래의 메시지와 함께 멈춰버렸습니다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> Unlink of file <span class="string">'파일명'</span> failed. Should I try again? (y/n)</span></span><br></pre></td></tr></table></figure>


<h3 id="해결방안"><a href="#해결방안" class="headerlink" title="해결방안"></a>해결방안</h3><p>해당 문제는 보통 <code>파일</code>을 다른 프로그램이 사용중일 경우에 발생하며, 파일을 잡고있는 다른 응용프로그램을 우선 종료해야합니다.</p>
<blockquote><p>This could mean that another program is using the file, which is preventing git from “moving” the file into or out of the working directory when you are attempting to change branches.</p>
<p>I have had this happen on Windows Vista where eclipse is the program “using” the file. The file may not be actually open in eclipse but may have been opened by a process run by eclipse.</p>
<p>In this event, try closing the file in any applications that might have used it. If that doesn’t work, completely exit any applications which may have opened the file.</p>
<footer><strong>stackoverflow</strong><cite><a href="https://stackoverflow.com/questions/4389833/unlink-of-file-failed-should-i-try-again" target="_blank" rel="noopener">unlink-of-file-failed-should-i-try-again</a></cite></footer></blockquote>

<blockquote><p>이것은 <code>다른 프로그램</code>이 파일을 <code>사용</code>하고 있다는 것을 의미 할 수 있습니다. 이는 git이 브랜치를 변경하려고 할 때 작업 디렉토리 안팎으로 파일을 “이동”하지 못하게합니다.</p>
<p>나는 Windows Vista에서 eclipse가 파일을 “사용”하는 프로그램을 사용하고있다. 파일은 이클립스에서 실제로 열리지 않을 수도 있지만 <code>이클립스에서 실행되는 프로세스</code>에 의해 열렸을 수 있습니다.</p>
<p>이 경우 <code>파일을 사용한 적이있는 응용 프로그램에서 파일을 닫으십시오.</code> 그래도 작동하지 않으면 파일을 열었을 수있는 응용 프로그램을 모두 종료하십시오.</p>
</blockquote>


<h3 id="마무리"><a href="#마무리" class="headerlink" title="마무리"></a>마무리</h3><p>가장 의심스러웠던 후배 컴퓨터의 <code>eclipse</code>를 종료하였고. 다시 <code>git pull</code> 을 실행하자 <code>diff</code> 창이 정상적으로 떴으며, 문제가 해결되었습니다.<br>이번 문제는 <code>eclipse</code>의 <code>synchronize</code>가 중간에 꼬이면서 발생한 것으로 보입니다. eclipse를 재실행 한 뒤에는 해당 문제가 발생하지 않았습니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Git/">Git</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/git/">git</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/08/20/CSRF-이해하기/"><span>CSRF 이해하기</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/08/20/CSRF-이해하기/" rel="bookmark">
        <time class="entry-date published" datetime="2018-08-20T07:44:43.000Z">
          2018-08-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Express 팀의 <a href="https://github.com/pillarjs/csrf" target="_blank" rel="noopener">csrf</a>와<br><a href="https://github.com/expressjs/csurf" target="_blank" rel="noopener">csurf</a> 모듈은 암호화 기능의 사용에 대해 의문을<br>가지는 이슈가 자주 올라옵니다. 이는 CSRF 토큰이 작동하는 방식을 잘못 이해해서 발생하는<br>의문이라고 생각합니다. 어째든, 빠르게 진실을 알아봅시다!</p>
<p>이 문서를 읽고, 질문이 있거나 무언가 잘못된 것이 있다고 생각하면 이슈를 생성하세요!</p>
<h2 id="CSRF-공격은-어떻게-하는거죠"><a href="#CSRF-공격은-어떻게-하는거죠" class="headerlink" title="CSRF 공격은 어떻게 하는거죠?"></a>CSRF 공격은 어떻게 하는거죠?</h2><p>공격자가 자신의 피싱 사이트에 다음과 같은 AJAX 버튼 또는 폼을 만들어 놓고 타겟의<br>사이트로 위조 요청을 보냅니다:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"https://my.site.com/me/something-destructive"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>여기를 누르면 공짜 돈을 드립니다!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>이것이 문제가 되는 이유는 공격자가 AJAX 등을 통해 <code>DELETE</code> 메서드와 같은 요청을 원본<br>사이트로 문제없이 보낼 수 있기 때문입니다. 만약 원본 사이트에서 세션 데이터나 중요한<br>개인 정보를 다룬다면 아주 중대한 문제입니다. 만약 기술적인 지식이 전무한 사용자가<br>이러한 상황을 만난다면 신용카드 정보 또는 사회 보장 정보를 입력할지도 모릅니다.</p>
<h2 id="CSRF-공격을-어떻게-방어하나요"><a href="#CSRF-공격을-어떻게-방어하나요" class="headerlink" title="CSRF 공격을 어떻게 방어하나요?"></a>CSRF 공격을 어떻게 방어하나요?</h2><h3 id="JSON-API만-사용"><a href="#JSON-API만-사용" class="headerlink" title="JSON API만 사용"></a>JSON API만 사용</h3><p>제한된 CORS 환경에서 JavaScript를 통한 AJAX 호출만 사용합니다. 이 방법은 <code>&lt;form&gt;</code>이<br><code>JSON</code> 같은 정보를 전송할 수 없다는 점을 이용하여 요청 값을 JSON만 허용하는<br>방법입니다. 이 방법은 상기한 형태의 폼을 통한 공격 가능성을 제거합니다.</p>
<h3 id="CORS-비활성화"><a href="#CORS-비활성화" class="headerlink" title="CORS 비활성화"></a>CORS 비활성화</h3><p>CSRF 공격을 배제하는 가장 첫 번째 방법은 cross-origin 요청을 비활성화하는 것입니다.<br>만약 CORS를 허용하려면 사이드 이펙트(부수효과)를 발생시키지 않는 <code>OPTIONS, HEAD, GET</code><br>메서드만 허용시켜야 합니다.</p>
<p>불행히도, 위의 메서드를 통한 요청들은 JavaScript를 사용하지 않으므로 모두 차단되지<br>않습니다. (따라서 CORS를 적용할 수 없습니다)</p>
<h3 id="헤더의-레퍼러-referer-확인"><a href="#헤더의-레퍼러-referer-확인" class="headerlink" title="헤더의 레퍼러(referer) 확인"></a>헤더의 레퍼러(referer) 확인</h3><p>불행히도, 레퍼러 헤더를 확인하는 것은 약간 좋지 않은 문제가 있습니다. 하지만 원본<br>사이트가 아닌 해커의 사이트로부터 들어오는 요청은 언제나 막습니다. 이 방법은 문제가<br>발생할 여지가 없습니다.</p>
<p>예를 들어, 레퍼러 헤더가 자신의 서버가 아닐 땐 세션을 로드할 수 없습니다.</p>
<h3 id="GET-메서드가-사이드-이펙트를-일으키지-않게하기"><a href="#GET-메서드가-사이드-이펙트를-일으키지-않게하기" class="headerlink" title="GET 메서드가 사이드 이펙트를 일으키지 않게하기"></a>GET 메서드가 사이드 이펙트를 일으키지 않게하기</h3><p><code>GET</code> 요청이 데이터베이스의 그 어떤 관련된 데이터도 변경할 수 없게 해야 합니다.<br>이는 주로 초보자들이 많이 하는 실수이며 무려 어플리케이션의 CSRF 공격을 넘어서 수 많은<br>공격을 가능하게 만듭니다.</p>
<h3 id="POST-사용-자제"><a href="#POST-사용-자제" class="headerlink" title="POST 사용 자제"></a>POST 사용 자제</h3><p>왜냐하면 <code>&lt;form&gt;</code>은 <code>GET</code>과 <code>POST</code> 메서드만 허용하기 때문입니다. 이러한 방식 대신<br><code>PUT</code>이나 <code>PATCH</code>, <code>DELETE</code> 같은 메서드를 사용하면 공격자가 사이트를 공격할 수 있는<br>방법이 크게 줄어듭니다.</p>
<h3 id="Method-Override-사용하지-않기"><a href="#Method-Override-사용하지-않기" class="headerlink" title="Method Override 사용하지 않기"></a>Method Override 사용하지 않기</h3><p>많은 어플리케이션들이 기본 폼에 <code>PUT</code> 과 <code>PATCH</code>, <code>DELETE</code> 요청을 지원하기 위해<br><a href="https://github.com/expressjs/method-override" target="_blank" rel="noopener">method-override</a>를 사용합니다.<br>하지만, 이것은, 요청을 완전히 취약점이 없는 취약점으로 변경했습니다.</p>
<p>그러니 어플리케이션에 <code>method-override</code>를 사용하지말고 그냥 AJAX를 쓰는게 낫습니다.</p>
<h3 id="오래된-브라우저는-지원하지-않기"><a href="#오래된-브라우저는-지원하지-않기" class="headerlink" title="오래된 브라우저는 지원하지 않기"></a>오래된 브라우저는 지원하지 않기</h3><p>오래된 브라우저는 CORS와 보안 정책을 지원하지 않습니다. 단순히 오래된 브라우저(주로<br>기술적인 지식이 부족한 컴맹들이 사용하며, 이들은 공격하기 더 쉽습니다)의 지원을 끊는<br>것 만으로도 CSRF 공격 경로를 최소화 할 수 있습니다.</p>
<h3 id="CSRF-토큰"><a href="#CSRF-토큰" class="headerlink" title="CSRF 토큰"></a>CSRF 토큰</h3><p>UNBEKNOWN<br>아아, 마지막 해결법은 바로 CSRF 토큰을 사용하는 것입니다. CSRF 토큰이 어떻게<br>작동하냐구요?</p>
<ol>
<li>서버가 클라이언트로 토큰을 전송합니다.</li>
<li>클라이언트가 폼을 토큰과 함께 제출합니다.</li>
<li>토큰이 올바르지 않으면 서버에서 요청을 거부합니다.</li>
</ol>
<p>공격자는 타겟 사이트에서 CSRF 토큰을 얻는 방법을 찾으려 할 것이고 이 때 JavaScript를<br>쓸 것입니다. 따라서 사이트가 CORS를 지원하지 않는다면 공격자가 CSRF 토큰을 얻을 수<br>있는 방법이 없습니다. 취약점을 제거하세요.</p>
<p><strong>반드시 AJAX를 통해 CSRF 토큰에 접근할 수 없도록 하세요!</strong><br><code>/csrf</code> 같이 바로 토큰을 받아올 수 있는 라우트는 만들지 말고, 특히 그 라우트에 CORS를<br>지원하지 마세요.</p>
<p>토큰은 추측할 수 없어야 하며, 이렇게 하면 공격자가 몇 번의 시도만으로 토큰을 얻기<br>힘들어집니다. 또한, 따로 암호학적인 보안이 필요하지 않습니다. 공격은 서버의 브루트 포스<br>공격이 아닌 사용자가 모르는 사이에 한두 번의 클릭으로 이루어집니다.</p>
<h2 id="BREACH-공격"><a href="#BREACH-공격" class="headerlink" title="BREACH 공격"></a>BREACH 공격</h2><p>여기선 salt를 함께 제공해야 합니다. BREACH 공격은 아주 간단합니다: 만약 서버가<br><code>HTTPS+gzip</code>를 통해 같거나 비슷한 응답을 여러 번 한다면, 공격자는 응답 본문의 컨텐츠를<br>예측할 수 있습니다. (HTTPS를 완전히 쓸모없게 만듭니다) 해결법? 각 응답을 약간씩 다르게<br>만들면 됩니다.</p>
<p>그러므로, CSRF 토큰은 각 요청을 기준으로 매번 다르게 생성됩니다. 하지만 서버는<br>각 요청에 포함된 토큰이 유효한지 확인할 수 있어야 합니다:</p>
<ol>
<li>암호학적으로 안전한 CSRF 토큰은 이제 서버에 의해서만 알려진, (가정) CSRF<br>“비밀”입니다.</li>
<li>이제 CSRF 토큰은 secret과 salt의 해시입니다.</li>
</ol>
<p>추가적인 내용은 다음을 참고하세요:</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/BREACH_(security_exploit)" target="_blank" rel="noopener">BREACH</a></li>
<li><a href="http://en.wikipedia.org/wiki/CRIME" target="_blank" rel="noopener">CRIME</a></li>
<li><a href="https://community.qualys.com/blogs/securitylabs/2013/08/07/defending-against-the-breach-attack" target="_blank" rel="noopener">BREACH 공격에 대한 방어</a></li>
<li>[Salt란?][2]</li>
<li><a href="http://d2.naver.com/helloworld/318732" target="_blank" rel="noopener">안전한 패스워드 저장 (한국어)</a></li>
</ul>
<p>참고로 CSRF은 BREACH 공격을 <em>해결</em> 하지 않습니다. 하지만 모듈은 간단히 요청을<br>무작위화 시켜 BREACH 공격을 완화시켜줍니다.</p>
<h2 id="Salt는-안전한-암호화를-할-필요가-없습니다"><a href="#Salt는-안전한-암호화를-할-필요가-없습니다" class="headerlink" title="Salt는 안전한 암호화를 할 필요가 없습니다"></a>Salt는 안전한 암호화를 할 필요가 없습니다</h2><p><strong>왜냐하면 클라이언트는 salt를 알고 있기 때문입니다!!!</strong><br>서버는 <code>&lt;salt&gt;;&lt;token&gt;</code>를 전송할 것이고 클라이언트는 서버로 같은 값을 요청에 포함하여<br>보낼 것 입니다. 그리고 서버는 <code>&lt;secret&gt;+&lt;salt&gt;=&lt;token&gt;</code>이 맞는지 확인할 것입니다.<br>salt는 반드시 토큰과 함께 전송되어야 합니다. 이렇지 않다면 서버는 토큰이 확실한지<br>확인할 수 없습니다.</p>
<p>이것은 간단한 암호학적인 방법입니다.<br>더 많은 방법들이 있지만 더 복잡하며 이 문제에 대해 효과적이지 않습니다.</p>
<h2 id="토큰-생성은-빨라야-합니다"><a href="#토큰-생성은-빨라야-합니다" class="headerlink" title="토큰 생성은 빨라야 합니다!"></a>토큰 생성은 빨라야 합니다!</h2><p><strong>왜냐하면 토큰은 매 요청마다 생성되어야 하기 때문입니다!</strong><br>이 작업은 간단히 <code>Math.random().toString(36).slice(2)</code> 이렇게만 해도 충분하며<br>뿐만 아니라 매우 고성능입니다! 각 요청에 대해 OpenSSL과 같은 암호학적으로 암호화된<br>토큰은 필요하지 않습니다.</p>
<h2 id="secret-데이터-은-비밀일-필요가-없습니다"><a href="#secret-데이터-은-비밀일-필요가-없습니다" class="headerlink" title="secret(데이터)은 비밀일 필요가 없습니다"></a>secret(데이터)은 비밀일 필요가 없습니다</h2><p>하지만 이것은. 데이터베이스를 사용하는 세션 스토어를 쓴다면 클라이언트는 절대 DB에<br>저장된 secret을 읽을 수 없습니다. 하지만 쿠키 세션을 사용한다면 secret은 쿠키에<br>저장되고 클라이언트에게 보내질 것입니다. 그러므로, <strong>쿠키 세션이 <code>httpOnly</code>를<br>사용하도록 하고 클라이언트가 secret을 client-side JavaScript로 읽을 수 없도록 해야<br>합니다!</strong></p>
<h2 id="CSRF-토큰을-잘못-사용하는-경우"><a href="#CSRF-토큰을-잘못-사용하는-경우" class="headerlink" title="CSRF 토큰을 잘못 사용하는 경우"></a>CSRF 토큰을 잘못 사용하는 경우</h2><h3 id="JSON-AJAX-요청에-CSRF-토큰을-사용"><a href="#JSON-AJAX-요청에-CSRF-토큰을-사용" class="headerlink" title="JSON AJAX 요청에 CSRF 토큰을 사용"></a>JSON AJAX 요청에 CSRF 토큰을 사용</h3><p>전술했듯이, 만약 CORS를 지원하지 않고 API가 JSON에 한정되어 있다면, AJAX 요청엔<br>CSRF 토큰을 포함시킬 수 있는 방법이 없습니다.</p>
<h3 id="CSRF-토큰을-AJAX로-전송"><a href="#CSRF-토큰을-AJAX로-전송" class="headerlink" title="CSRF 토큰을 AJAX로 전송"></a>CSRF 토큰을 AJAX로 전송</h3><p>어플리케이션에 <code>GET /csrf</code> 같은 라우트는 절때 만들어선 안되며 CORS를 활성화해서도<br>안됩니다. CSRF 토큰을 API 응답 본문에 포함하여 전송하면 안됩니다.</p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>최근 웹은 점점 JSON API를 사용하는 추세이며 브라우저는 더 많은 보안 정책으로 더<br>안전해지고 있기에 CSRF의 중요성은 점점 떨어지고 있습니다. 오래된 브라우저의 사이트<br>접속을 차단하고 많은 사이트 API를 JSON API로 변경하면 근본적으로 CSRF 토큰을 사용할<br>필요가 없어집니다. 그러나 안전을 위해, 언제든 가능할 때, 특히 구현에 사소한 상황이<br>아닐 경우 여전히 이것들을 구현하는 것이 좋습니다.</p>
<p><em>오타나 오역이 있을 수 있습니다. 문제를 발견했다면, 수정해서 PR을 넣어주세요. 많은<br>도움이 됩니다!</em></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
  <a href="/page/2/" class="pagination-next">Next</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2020 Park-JiHoon
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>